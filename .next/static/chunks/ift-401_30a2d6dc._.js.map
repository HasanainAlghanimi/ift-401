{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/lib/useDemoSession.ts"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nfunction readSession() {\r\n  try { return JSON.parse(localStorage.getItem(\"demo_session\") || \"null\"); }\r\n  catch { return null; }\r\n}\r\n\r\nexport function useDemoSession() {\r\n  const [session, setSession] = useState<any>(null);\r\n  const [ready, setReady] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const sync = () => {\r\n      setSession(readSession());\r\n      setReady(true);\r\n    };\r\n    sync();\r\n\r\n    const onStorage = (e: StorageEvent) => {\r\n      if (!e.key || e.key === \"demo_session\") { setSession(readSession()); }\r\n    };\r\n    const onAuthChanged = () => setSession(readSession());\r\n    const onVis = () => { if (document.visibilityState === \"visible\") setSession(readSession()); };\r\n\r\n    window.addEventListener(\"storage\", onStorage);\r\n    window.addEventListener(\"demo-auth-changed\", onAuthChanged);\r\n    document.addEventListener(\"visibilitychange\", onVis);\r\n    return () => {\r\n      window.removeEventListener(\"storage\", onStorage);\r\n      window.removeEventListener(\"demo-auth-changed\", onAuthChanged);\r\n      document.removeEventListener(\"visibilitychange\", onVis);\r\n    };\r\n  }, []);\r\n\r\n  return { session, isLoggedIn: !!session, ready };\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AADA;;AAGA,SAAS;IACP,IAAI;QAAE,OAAO,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,mBAAmB;IAAS,EACzE,UAAM;QAAE,OAAO;IAAM;AACvB;AAEO,SAAS;;IACd,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,uLAAQ,EAAM;IAC5C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,uLAAQ,EAAC;IAEnC,IAAA,wLAAS;oCAAC;YACR,MAAM;iDAAO;oBACX,WAAW;oBACX,SAAS;gBACX;;YACA;YAEA,MAAM;sDAAY,CAAC;oBACjB,IAAI,CAAC,EAAE,GAAG,IAAI,EAAE,GAAG,KAAK,gBAAgB;wBAAE,WAAW;oBAAgB;gBACvE;;YACA,MAAM;0DAAgB,IAAM,WAAW;;YACvC,MAAM;kDAAQ;oBAAQ,IAAI,SAAS,eAAe,KAAK,WAAW,WAAW;gBAAgB;;YAE7F,OAAO,gBAAgB,CAAC,WAAW;YACnC,OAAO,gBAAgB,CAAC,qBAAqB;YAC7C,SAAS,gBAAgB,CAAC,oBAAoB;YAC9C;4CAAO;oBACL,OAAO,mBAAmB,CAAC,WAAW;oBACtC,OAAO,mBAAmB,CAAC,qBAAqB;oBAChD,SAAS,mBAAmB,CAAC,oBAAoB;gBACnD;;QACF;mCAAG,EAAE;IAEL,OAAO;QAAE;QAAS,YAAY,CAAC,CAAC;QAAS;IAAM;AACjD;GA5BgB","debugId":null}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/lib/supabaseClient.ts"],"sourcesContent":["'use client'\r\n\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n)\r\n"],"names":[],"mappings":";;;;AAKE;AAHF;AAFA;;AAIO,MAAM,WAAW,IAAA,wNAAY","debugId":null}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/components/NavBar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport React from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useDemoSession } from \"@/lib/useDemoSession\";\r\nimport { supabase } from \"@/lib/supabaseClient\";\r\n\r\nconst links = [\r\n  { href: \"/\", label: \"Home\" },\r\n  { href: \"/stocks\", label: \"Stocks\" },\r\n  { href: \"/trade\", label: \"Trade\", authOnly: true },\r\n  { href: \"/portfolio\", label: \"Portfolio\", authOnly: true },\r\n  { href: \"/history\", label: \"History\", authOnly: true },\r\n  { href: \"/account\", label: \"Account\", authOnly: true },\r\n  { href: \"/admin\", label: \"Admin\", authOnly: true },\r\n];\r\n\r\nexport default function NavBar() {\r\n  const router = useRouter();\r\n  const { isLoggedIn } = useDemoSession();\r\n  const [mounted, setMounted] = React.useState(false);\r\n  const [balance, setBalance] = React.useState<number | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (!mounted || !isLoggedIn) return;\r\n\r\n    const loadBalanceForUser = async () => {\r\n      try {\r\n        // 1) Get email from demo_session\r\n        let email: string | null = null;\r\n        if (typeof window !== \"undefined\") {\r\n          try {\r\n            const raw = window.localStorage.getItem(\"demo_session\");\r\n            if (raw) {\r\n              const parsed = JSON.parse(raw);\r\n              email = parsed.email ?? null;\r\n            }\r\n          } catch {\r\n            email = null;\r\n          }\r\n        }\r\n        if (!email) {\r\n          setBalance(0);\r\n          return;\r\n        }\r\n\r\n        // 2) Look up user_id\r\n        const { data: userRows, error: userError } = await supabase\r\n          .from(\"users\")\r\n          .select(\"user_id\")\r\n          .eq(\"email\", email)\r\n          .limit(1);\r\n\r\n        if (userError || !userRows || userRows.length === 0) {\r\n          setBalance(0);\r\n          return;\r\n        }\r\n\r\n        const userId = userRows[0].user_id as number;\r\n\r\n        // 3) Look up that user's account\r\n        const { data: accRows, error: accError } = await supabase\r\n          .from(\"account\")\r\n          .select(\"available_balance\")\r\n          .eq(\"user_id\", userId)\r\n          .limit(1);\r\n\r\n        if (accError || !accRows || accRows.length === 0) {\r\n          setBalance(0);\r\n          return;\r\n        }\r\n\r\n        setBalance(Number(accRows[0].available_balance) || 0);\r\n      } catch {\r\n        setBalance(0);\r\n      }\r\n    };\r\n\r\n    loadBalanceForUser();\r\n\r\n    const handler = (event: Event) => {\r\n      const e = event as CustomEvent<{ availableBalance?: number }>;\r\n      if (e.detail && typeof e.detail.availableBalance === \"number\") {\r\n        setBalance(e.detail.availableBalance);\r\n      } else {\r\n        loadBalanceForUser();\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"demo-balance-changed\", handler);\r\n    return () => window.removeEventListener(\"demo-balance-changed\", handler);\r\n  }, [mounted, isLoggedIn]);\r\n\r\n  const handleLogout = () => {\r\n    if (typeof window !== \"undefined\") {\r\n      localStorage.removeItem(\"demo_session\");\r\n      window.dispatchEvent(new Event(\"demo-auth-changed\"));\r\n    }\r\n    router.refresh();\r\n  };\r\n\r\n  const formattedBalance =\r\n    mounted && isLoggedIn && balance !== null\r\n      ? `$${balance.toLocaleString(\"en-US\", {\r\n          minimumFractionDigits: 2,\r\n          maximumFractionDigits: 2,\r\n        })}`\r\n      : \"$0.00\";\r\n\r\n  return (\r\n    <header className=\"nav\">\r\n      <div className=\"nav__inner\">\r\n        <Link href=\"/\" className=\"brand\">\r\n          <span className=\"brand__logo\">ðŸŒ•</span>\r\n          <span className=\"brand__name\">Callisto</span>\r\n        </Link>\r\n\r\n        <nav className=\"nav__links\" aria-label=\"Primary\">\r\n          {mounted &&\r\n            links\r\n              .filter((l) => !l.authOnly || isLoggedIn)\r\n              .map((l) => (\r\n                <Link key={l.href} href={l.href} className=\"nav__link\">\r\n                  {l.label}\r\n                </Link>\r\n              ))}\r\n        </nav>\r\n\r\n        {mounted && isLoggedIn && (\r\n          <div\r\n            style={{\r\n              marginLeft: \"1rem\",\r\n              marginRight: \"1rem\",\r\n              padding: \"4px 12px\",\r\n              borderRadius: 999,\r\n              background: \"#333\",\r\n              fontSize: \"0.85rem\",\r\n            }}\r\n          >\r\n            {formattedBalance}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"nav__actions\">\r\n          {mounted &&\r\n            (isLoggedIn ? (\r\n              <button onClick={handleLogout} className=\"btn btn--ghost\">\r\n                Log out\r\n              </button>\r\n            ) : (\r\n              <>\r\n                <Link href=\"/signin\" className=\"btn btn--ghost\">\r\n                  Sign in</Link>\r\n                <Link href=\"/signup\" className=\"btn btn--primary\">\r\n                  Sign up</Link>\r\n              </>\r\n            ))}\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}