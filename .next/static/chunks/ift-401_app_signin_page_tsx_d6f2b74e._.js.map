{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/app/signin/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useDemoSession } from '@/lib/useDemoSession';\r\nimport { supabase } from '@/lib/supabaseClient';\r\n\r\ntype FormState = {\r\n  email: string;\r\n  password: string;\r\n  remember: boolean;\r\n};\r\n\r\ntype Role = 'admin' | 'user';\r\n\r\nexport default function SignInPage() {\r\n  const [form, setForm] = useState<FormState>({ email: '', password: '', remember: true });\r\n  const [errors, setErrors] = useState<Partial<FormState> & { general?: string }>({});\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const router = useRouter();\r\n  const { isLoggedIn } = useDemoSession();\r\n\r\n  // local mount/session check to avoid flicker\r\n  const [mounted, setMounted] = useState(false);\r\n  const [hasSession, setHasSession] = useState<boolean | null>(null);\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    try {\r\n      setHasSession(!!localStorage.getItem('demo_session'));\r\n    } catch {\r\n      setHasSession(false);\r\n    }\r\n  }, []);\r\n\r\n  const onChange =\r\n    (key: keyof FormState) =>\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      const value = key === 'remember' ? (e.target as HTMLInputElement).checked : e.target.value;\r\n      setForm((f) => ({ ...f, [key]: value }));\r\n      setErrors((err) => ({ ...err, [key]: undefined, general: undefined }));\r\n    };\r\n\r\n  const validate = () => {\r\n    const next: typeof errors = {};\r\n    if (!/^\\S+@\\S+\\.\\S+$/.test(form.email)) next.email = 'Enter a valid email';\r\n    if (!form.password.trim()) next.password = 'Password is required';\r\n    setErrors(next);\r\n    return Object.keys(next).length === 0;\r\n  };\r\n\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!validate()) return;\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      setErrors({});\r\n\r\n      // 1) Real Supabase login\r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email: form.email,\r\n        password: form.password,\r\n      });\r\n\r\n      if (error) {\r\n        // Supabase will give messages like \"Invalid login credentials\"\r\n        setErrors({ general: error.message });\r\n        return;\r\n      }\r\n\r\n      // 2) Look up this user in your public.users table to get user_type\r\n      const { data: userRow, error: userRowError } = await supabase\r\n        .from('users')\r\n        .select('user_type')\r\n        .eq('email', form.email)\r\n        .single();\r\n\r\n      let role: Role = 'user';\r\n      if (!userRowError && userRow?.user_type === 'Admin') {\r\n        role = 'admin';\r\n      }\r\n\r\n      // 3) Store session (email + role) so useDemoSession and /admin gate can use it\r\n      localStorage.setItem(\r\n        'demo_session',\r\n        JSON.stringify({\r\n          email: form.email,\r\n          remember: form.remember,\r\n          role, // 'admin' or 'user'\r\n        })\r\n      );\r\n      window.dispatchEvent(new Event('demo-auth-changed'));\r\n\r\n      // 4) Logged in successfully, go home\r\n      router.replace('/');\r\n    } catch (err) {\r\n      console.error(err);\r\n      setErrors({ general: 'Something went wrong. Please try again.' });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('demo_session');\r\n    window.dispatchEvent(new Event('demo-auth-changed'));\r\n    router.replace('/');\r\n  };\r\n\r\n  if (!mounted) return null;\r\n\r\n  // If signed in already, show message instead of auto-redirecting\r\n  if (isLoggedIn || hasSession) {\r\n    return (\r\n      <main className=\"auth\">\r\n        <div className=\"auth__wrap\">\r\n          <div className=\"auth__card\">\r\n            <h1 className=\"auth__title\">You’re already signed in</h1>\r\n            <p className=\"auth__subtitle\">Want to go back or sign out?</p>\r\n            <div className=\"auth__form\" style={{ display: 'grid', gap: 10 }}>\r\n              <button className=\"btn btn--primary\" onClick={() => router.replace('/')}>\r\n                Go home\r\n              </button>\r\n              <button className=\"btn btn--ghost\" onClick={handleLogout}>\r\n                Log out\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <main className=\"auth\">\r\n      <div className=\"auth__wrap\">\r\n        <div className=\"auth__card\">\r\n          <h1 className=\"auth__title\">Welcome back</h1>\r\n          <p className=\"auth__subtitle\">Sign in to continue trading faster than everyone else.</p>\r\n\r\n          {errors.general && <div className=\"auth__alert\">{errors.general}</div>}\r\n\r\n          <form onSubmit={onSubmit} className=\"auth__form\">\r\n            <label className=\"field\">\r\n              <span className=\"field__label\">Email</span>\r\n              <input\r\n                className={`field__input ${errors.email ? 'is-error' : ''}`}\r\n                type=\"email\"\r\n                value={form.email}\r\n                onChange={onChange('email')}\r\n                placeholder=\"jane.doe@example.com\"\r\n                autoComplete=\"email\"\r\n              />\r\n              {errors.email && <span className=\"field__hint\">{errors.email}</span>}\r\n            </label>\r\n\r\n            <label className=\"field\">\r\n              <span className=\"field__label\">Password</span>\r\n              <input\r\n                className={`field__input ${errors.password ? 'is-error' : ''}`}\r\n                type=\"password\"\r\n                value={form.password}\r\n                onChange={onChange('password')}\r\n                placeholder=\"••••••••\"\r\n                autoComplete=\"current-password\"\r\n              />\r\n              {errors.password && <span className=\"field__hint\">{errors.password}</span>}\r\n            </label>\r\n\r\n            <label className=\"check\">\r\n              <input type=\"checkbox\" checked={form.remember} onChange={onChange('remember')} />\r\n              <span>Remember me</span>\r\n            </label>\r\n\r\n            <button className=\"btn btn--primary auth__submit\" disabled={isLoading}>\r\n              {isLoading ? 'Signing in…' : 'Sign in'}\r\n            </button>\r\n\r\n            <p className=\"auth__foot\">\r\n              New here? <Link href=\"/signup\">Create an account</Link>\r\n            </p>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}