{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/app/history/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabaseClient';\r\n\r\ntype Side = 'BUY' | 'SELL';\r\ntype OrderType = 'MARKET';\r\n\r\ntype UiOrder = {\r\n  id: number;\r\n  time: string;\r\n  symbol: string;\r\n  side: Side;\r\n  type: OrderType;\r\n  qty: number;\r\n  fillPrice: number;\r\n  limitPrice?: number | null;\r\n};\r\n\r\nconst fmtMoney = (n: number) =>\r\n  `$${n.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;\r\nconst fmtDate = (iso: string) =>\r\n  new Date(iso).toLocaleString([], { hour12: false });\r\n\r\nexport default function HistoryPage() {\r\n  const router = useRouter();\r\n\r\n  const [mounted, setMounted] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [orders, setOrders] = useState<UiOrder[]>([]);\r\n  const [loadError, setLoadError] = useState<string | null>(null);\r\n\r\n  const [search, setSearch] = useState('');\r\n  const [side, setSide] = useState<'ALL' | Side>('ALL');\r\n  const [sortBy, setSortBy] = useState<'time' | 'symbol' | 'amount'>('time');\r\n  const [dir, setDir] = useState<'asc' | 'desc'>('desc');\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n\r\n      try {\r\n        const raw = localStorage.getItem('demo_session');\r\n        if (!raw) {\r\n          router.replace('/signin');\r\n          return;\r\n        }\r\n\r\n        const session = JSON.parse(raw);\r\n        const email = session?.email;\r\n\r\n        if (!email) {\r\n          setLoadError('Invalid session.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Get user_id\r\n        const { data: userRow } = await supabase\r\n          .from('users')\r\n          .select('user_id')\r\n          .eq('email', email)\r\n          .maybeSingle();\r\n\r\n        if (!userRow) {\r\n          setLoadError('User not found.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const userId = userRow.user_id;\r\n\r\n        // Get account_id\r\n        const { data: acct } = await supabase\r\n          .from('account')\r\n          .select('account_id')\r\n          .eq('user_id', userId)\r\n          .maybeSingle();\r\n\r\n        if (!acct) {\r\n          setLoadError('No account found.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const accountId = acct.account_id;\r\n\r\n        // Get orders for account\r\n        const { data: orderRows } = await supabase\r\n          .from('orders')\r\n          .select(\r\n            `\r\n            order_id,\r\n            order_date,\r\n            side,\r\n            order_type,\r\n            quantity,\r\n            price,\r\n            ticker (\r\n              symbol\r\n            )\r\n          `\r\n          )\r\n          .eq('account_id', accountId)\r\n          .order('order_date', { ascending: false });\r\n\r\n        if (!orderRows) {\r\n          setOrders([]);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const uiOrders: UiOrder[] = orderRows.map((o: any) => ({\r\n          id: o.order_id,\r\n          time: o.order_date,\r\n          symbol: o.ticker?.symbol ?? '—',\r\n          side: o.side.toUpperCase(),\r\n          type: o.order_type.toUpperCase(),\r\n          qty: o.quantity,\r\n          fillPrice: o.price,\r\n          limitPrice: o.limit_price ?? null\r\n        }));\r\n\r\n        setOrders(uiOrders);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error(err);\r\n        setLoadError('Failed to load history.');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, [mounted, router]);\r\n\r\n  const toggleSort = (col: typeof sortBy) => {\r\n    if (col === sortBy) {\r\n      setDir(dir === 'asc' ? 'desc' : 'asc');\r\n    } else {\r\n      setSortBy(col);\r\n      setDir('desc');\r\n    }\r\n  };\r\n\r\n  const filtered = useMemo(() => {\r\n    const s = search.trim().toUpperCase();\r\n\r\n    let rows = orders.filter((o) => {\r\n      return (\r\n        (!s || o.symbol.includes(s)) &&\r\n        (side === 'ALL' || o.side === side)\r\n      );\r\n    });\r\n\r\n    rows = rows.sort((a, b) => {\r\n      let delta = 0;\r\n\r\n      if (sortBy === 'time') {\r\n        delta = new Date(a.time).getTime() - new Date(b.time).getTime();\r\n      }\r\n      if (sortBy === 'symbol') {\r\n        delta = a.symbol.localeCompare(b.symbol);\r\n      }\r\n      if (sortBy === 'amount') {\r\n        delta = a.fillPrice * a.qty - b.fillPrice * b.qty;\r\n      }\r\n\r\n      return dir === 'asc' ? delta : -delta;\r\n    });\r\n\r\n    return rows;\r\n  }, [orders, search, side, sortBy, dir]);\r\n\r\n  if (!mounted) return null;\r\n\r\n  return (\r\n    <main className=\"container\" style={{ paddingTop: 24, paddingBottom: 24 }}>\r\n      <div className=\"pageheader\">\r\n        <div>\r\n          <h1 className=\"stocks__title\">History</h1>\r\n          <p className=\"stocks__sub\">All filled orders for this account.</p>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <p>Loading…</p>\r\n      ) : loadError ? (\r\n        <p className=\"trade__alert is-error\">{loadError}</p>\r\n      ) : (\r\n        <>\r\n          {/* Filters */}\r\n          <div className=\"actions-row\" style={{ marginBottom: 8 }}>\r\n            <input\r\n              className=\"field__input\"\r\n              placeholder=\"Search symbol…\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              style={{ width: 220 }}\r\n            />\r\n\r\n            <div className=\"pillgroup\">\r\n              <button\r\n                className={`pillbtn ${side === 'ALL' ? 'is-active' : ''}`}\r\n                onClick={() => setSide('ALL')}\r\n              >\r\n                All\r\n              </button>\r\n              <button\r\n                className={`pillbtn ${side === 'BUY' ? 'is-active' : ''}`}\r\n                onClick={() => setSide('BUY')}\r\n              >\r\n                Buy\r\n              </button>\r\n              <button\r\n                className={`pillbtn ${side === 'SELL' ? 'is-active' : ''}`}\r\n                onClick={() => setSide('SELL')}\r\n              >\r\n                Sell\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* HEADER */}\r\n          <div className=\"table__head is-sticky history-grid\">\r\n            <button onClick={() => toggleSort('time')}>\r\n              Time\r\n            </button>\r\n            <button onClick={() => toggleSort('symbol')}>\r\n              Symbol\r\n            </button>\r\n            <button>Side</button>\r\n            <button>Type</button>\r\n            <button>Qty</button>\r\n            <button>Limit</button>\r\n            <button onClick={() => toggleSort('amount')}>\r\n              Fill\r\n            </button>\r\n          </div>\r\n\r\n          {/* ROWS */}\r\n          <ul className=\"table__body\">\r\n            {filtered.map((o) => {\r\n              const notional = o.fillPrice * o.qty;\r\n\r\n              return (\r\n                <li key={o.id} className=\"row history-grid\">\r\n                  <div className=\"name\">\r\n                    <strong>{fmtDate(o.time)}</strong>\r\n                    <span className=\"symbol\">ID: {o.id}</span>\r\n                  </div>\r\n\r\n                  <div className=\"num\">{o.symbol}</div>\r\n\r\n                  <div\r\n                    className={`num ${\r\n                      o.side === 'BUY' ? 'is-up' : 'is-down'\r\n                    }`}\r\n                  >\r\n                    {o.side}\r\n                  </div>\r\n\r\n                  <div className=\"num\">{o.type}</div>\r\n\r\n                  <div className=\"num\">{o.qty}</div>\r\n\r\n                  <div className=\"num\">\r\n                    {o.limitPrice ? fmtMoney(o.limitPrice) : '-'}\r\n                  </div>\r\n\r\n                  <div className=\"num\">\r\n                    {fmtMoney(o.fillPrice)}{' '}\r\n                    <span className=\"symbol\">\r\n                      ({fmtMoney(notional)})\r\n                    </span>\r\n                  </div>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        </>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}