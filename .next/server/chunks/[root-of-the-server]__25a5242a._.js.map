{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabaseServer = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,iBAAiB,IAAA,uNAAY,gFAExC,QAAQ,GAAG,CAAC,yBAAyB","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/app/api/account/create/route.ts"],"sourcesContent":["// app/api/account/create/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { supabaseServer } from '@/lib/supabaseServer';\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { email, name, accountType } = await req.json();\r\n\r\n    if (!email) {\r\n      return NextResponse.json(\r\n        { error: 'email is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Map front-end accountType to your existing user_type values\r\n    const userType = accountType === 'admin' ? 'Admin' : 'Customer';\r\n\r\n    // Split \"Full name\" best-effort into first/last\r\n    let firstName: string | null = null;\r\n    let lastName: string | null = null;\r\n    if (name && name.trim()) {\r\n      const parts = name.trim().split(' ');\r\n      firstName = parts[0] ?? null;\r\n      lastName = parts.slice(1).join(' ') || null;\r\n    }\r\n\r\n    const username = email.split('@')[0];\r\n\r\n    // 1) Upsert into public.users by email (this part is working for you)\r\n    const { data: userRow, error: userError } = await supabaseServer\r\n      .from('users')\r\n      .upsert(\r\n        {\r\n          email,\r\n          username,\r\n          password: 'supabase_auth',\r\n          first_name: firstName,\r\n          last_name: lastName,\r\n          user_type: userType,\r\n        },\r\n        { onConflict: 'email' }\r\n      )\r\n      .select('user_id, user_type')\r\n      .single();\r\n\r\n    if (userError) {\r\n      console.error('Create users row error:', userError);\r\n      return NextResponse.json(\r\n        { error: userError.message },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const userIdInt = userRow.user_id as number;\r\n\r\n    // Generate a simple account number like ACC000011\r\n    const accountNumber = `ACC${String(userIdInt).padStart(6, '0')}`;\r\n\r\n    // 2) INSERT into public.account (no onConflict)\r\n    const { data: accountRow, error: accountError } = await supabaseServer\r\n      .from('account')\r\n      .insert({\r\n        user_id: userIdInt,\r\n        account_number: accountNumber,\r\n        balance: 0,\r\n        available_balance: 0,\r\n        pending_deposits: 0,\r\n        pending_withdrawals: 0,\r\n      })\r\n      .select('account_id, user_id, balance, available_balance')\r\n      .single();\r\n\r\n    if (accountError) {\r\n      console.error('Create account row error:', accountError);\r\n      return NextResponse.json(\r\n        { error: accountError.message },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { user: userRow, account: accountRow },\r\n      { status: 200 }\r\n    );\r\n  } catch (err) {\r\n    console.error('Create account API error:', err);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnD,IAAI,CAAC,OAAO;YACV,OAAO,8JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,8DAA8D;QAC9D,MAAM,WAAW,gBAAgB,UAAU,UAAU;QAErD,gDAAgD;QAChD,IAAI,YAA2B;QAC/B,IAAI,WAA0B;QAC9B,IAAI,QAAQ,KAAK,IAAI,IAAI;YACvB,MAAM,QAAQ,KAAK,IAAI,GAAG,KAAK,CAAC;YAChC,YAAY,KAAK,CAAC,EAAE,IAAI;YACxB,WAAW,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ;QACzC;QAEA,MAAM,WAAW,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QAEpC,sEAAsE;QACtE,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,uJAAc,CAC7D,IAAI,CAAC,SACL,MAAM,CACL;YACE;YACA;YACA,UAAU;YACV,YAAY;YACZ,WAAW;YACX,WAAW;QACb,GACA;YAAE,YAAY;QAAQ,GAEvB,MAAM,CAAC,sBACP,MAAM;QAET,IAAI,WAAW;YACb,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO,8JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,UAAU,OAAO;YAAC,GAC3B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,QAAQ,OAAO;QAEjC,kDAAkD;QAClD,MAAM,gBAAgB,CAAC,GAAG,EAAE,OAAO,WAAW,QAAQ,CAAC,GAAG,MAAM;QAEhE,gDAAgD;QAChD,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,uJAAc,CACnE,IAAI,CAAC,WACL,MAAM,CAAC;YACN,SAAS;YACT,gBAAgB;YAChB,SAAS;YACT,mBAAmB;YACnB,kBAAkB;YAClB,qBAAqB;QACvB,GACC,MAAM,CAAC,mDACP,MAAM;QAET,IAAI,cAAc;YAChB,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,OAAO,8JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,aAAa,OAAO;YAAC,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,8JAAY,CAAC,IAAI,CACtB;YAAE,MAAM;YAAS,SAAS;QAAW,GACrC;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,8JAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}