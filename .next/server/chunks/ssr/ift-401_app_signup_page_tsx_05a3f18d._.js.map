{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/app/signup/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useDemoSession } from '@/lib/useDemoSession';\r\nimport { supabase } from '@/lib/supabaseClient';\r\n\r\n// -------------------- Types --------------------\r\ntype FormState = {\r\n  name: string;\r\n  email: string;\r\n  password: string;\r\n  confirm: string;\r\n  agree: boolean;\r\n  accountType: 'customer' | 'admin';   // ðŸ‘ˆ NEW FIELD\r\n};\r\n\r\nexport default function SignUpPage() {\r\n  const [form, setForm] = useState<FormState>({\r\n    name: '',\r\n    email: '',\r\n    password: '',\r\n    confirm: '',\r\n    agree: false,\r\n    accountType: 'customer',           // default\r\n  });\r\n\r\n  const [errors, setErrors] = useState<\r\n    Partial<FormState> & { general?: string }\r\n  >({});\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const router = useRouter();\r\n  const { isLoggedIn } = useDemoSession();\r\n\r\n  const [mounted, setMounted] = useState(false);\r\n  const [hasSession, setHasSession] = useState<boolean | null>(null);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    try {\r\n      setHasSession(!!localStorage.getItem('demo_session'));\r\n    } catch {\r\n      setHasSession(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n    if (isLoggedIn || hasSession) router.replace('/');\r\n  }, [mounted, isLoggedIn, hasSession, router]);\r\n\r\n  const onChange =\r\n    (key: keyof FormState) =>\r\n    (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n      const value =\r\n        key === 'agree'\r\n          ? (e.target as HTMLInputElement).checked\r\n          : e.target.value;\r\n\r\n      setForm((f) => ({ ...f, [key]: value }));\r\n      setErrors((err) => ({ ...err, [key]: undefined, general: undefined }));\r\n    };\r\n\r\n  // -------------------- Validation --------------------\r\n  const validate = () => {\r\n    const next: typeof errors = {};\r\n    if (!form.name.trim()) next.name = 'Name is required';\r\n    if (!/^\\S+@\\S+\\.\\S+$/.test(form.email)) next.email = 'Enter a valid email';\r\n    if (form.password.length < 6) next.password = 'Min 6 characters';\r\n    if (form.password !== form.confirm)\r\n      next.confirm = 'Passwords do not match';\r\n    if (!form.agree) next.general = 'You must accept the Terms';\r\n\r\n    setErrors(next);\r\n    return Object.keys(next).length === 0;\r\n  };\r\n\r\n  // -------------------- Submit --------------------\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!validate()) return;\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      setErrors({});\r\n\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email: form.email,\r\n        password: form.password,\r\n      });\r\n\r\n      if (error) {\r\n        setErrors({ general: error.message });\r\n        return;\r\n      }\r\n\r\n      const userId = data.user?.id;\r\n\r\n      if (userId) {\r\n        await fetch('/api/account/create', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            userId,                    // not used anymore, but fine\r\n            name: form.name,\r\n            email: form.email,\r\n            accountType: form.accountType, // 'user' | 'admin'\r\n          }),\r\n        });\r\n      }\r\n\r\n\r\n      localStorage.setItem(\r\n        'demo_session',\r\n        JSON.stringify({ email: form.email, role: form.accountType })\r\n      );\r\n      window.dispatchEvent(new Event('demo-auth-changed'));\r\n\r\n      await new Promise((r) => setTimeout(r, 250));\r\n\r\n      router.replace('/');\r\n    } catch {\r\n      setErrors({ general: 'Something went wrong. Please try again.' });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!mounted) return null;\r\n  if (isLoggedIn || hasSession) return null;\r\n\r\n  return (\r\n    <main className=\"auth\">\r\n      <div className=\"auth__wrap\">\r\n        <div className=\"auth__card\">\r\n          <h1 className=\"auth__title\">Create your account</h1>\r\n          <p className=\"auth__subtitle\">\r\n            Trade faster than Robinhood. No fees. No risk.\r\n          </p>\r\n\r\n          {errors.general && (\r\n            <div className=\"auth__alert\">{errors.general}</div>\r\n          )}\r\n\r\n          <form onSubmit={onSubmit} className=\"auth__form\">\r\n            {/* Full Name */}\r\n            <label className=\"field\">\r\n              <span className=\"field__label\">Full name</span>\r\n              <input\r\n                className={`field__input ${\r\n                  errors.name ? 'is-error' : ''\r\n                }`}\r\n                type=\"text\"\r\n                value={form.name}\r\n                onChange={onChange('name')}\r\n                placeholder=\"Jane Doe\"\r\n              />\r\n              {errors.name && (\r\n                <span className=\"field__hint\">{errors.name}</span>\r\n              )}\r\n            </label>\r\n\r\n            {/* Email */}\r\n            <label className=\"field\">\r\n              <span className=\"field__label\">Email</span>\r\n              <input\r\n                className={`field__input ${\r\n                  errors.email ? 'is-error' : ''\r\n                }`}\r\n                type=\"email\"\r\n                value={form.email}\r\n                onChange={onChange('email')}\r\n                placeholder=\"jane@example.com\"\r\n              />\r\n              {errors.email && (\r\n                <span className=\"field__hint\">{errors.email}</span>\r\n              )}\r\n            </label>\r\n\r\n            {/* Account Type (NEW) */}\r\n            <label className=\"field\">\r\n              <span className=\"field__label\">Account Type</span>\r\n              <select\r\n                className=\"field__input\"\r\n                value={form.accountType}\r\n                onChange={(e) =>\r\n                  setForm((f) => ({\r\n                    ...f,\r\n                    accountType: e.target.value as 'customer' | 'admin',\r\n                  }))\r\n                }\r\n              >\r\n                <option value=\"customer\">Customer</option>\r\n                <option value=\"admin\">Admin</option>\r\n              </select>\r\n            </label>\r\n\r\n            {/* Password Row */}\r\n            <div className=\"fieldrow\">\r\n              <label className=\"field\">\r\n                <span className=\"field__label\">Password</span>\r\n                <input\r\n                  className={`field__input ${\r\n                    errors.password ? 'is-error' : ''\r\n                  }`}\r\n                  type=\"password\"\r\n                  value={form.password}\r\n                  onChange={onChange('password')}\r\n                  placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                />\r\n              </label>\r\n\r\n              <label className=\"field\">\r\n                <span className=\"field__label\">Confirm password</span>\r\n                <input\r\n                  className={`field__input ${\r\n                    errors.confirm ? 'is-error' : ''\r\n                  }`}\r\n                  type=\"password\"\r\n                  value={form.confirm}\r\n                  onChange={onChange('confirm')}\r\n                  placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                />\r\n                {errors.confirm && (\r\n                  <span className=\"field__hint\">{errors.confirm}</span>\r\n                )}\r\n              </label>\r\n            </div>\r\n\r\n            {/* Terms */}\r\n            <label className=\"check\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={form.agree}\r\n                onChange={onChange('agree')}\r\n              />\r\n              <span>I agree to the Terms and Privacy Policy.</span>\r\n            </label>\r\n\r\n            {/* Submit */}\r\n            <button\r\n              className=\"btn btn--primary auth__submit\"\r\n              disabled={isLoading}\r\n            >\r\n              {isLoading ? 'Creating accountâ€¦' : 'Sign up'}\r\n            </button>\r\n\r\n            <p className=\"auth__foot\">\r\n              Already have an account?{' '}\r\n              <Link href=\"/signin\">Sign in</Link>\r\n            </p>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}