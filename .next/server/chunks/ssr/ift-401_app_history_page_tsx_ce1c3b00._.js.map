{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hasan/ift-401/app/history/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useDemoSession } from '@/lib/useDemoSession';\r\n\r\ntype Side = 'BUY' | 'SELL';\r\ntype OrderType = 'MARKET' | 'LIMIT';\r\ntype Order = {\r\n  id: string;\r\n  time: string;              // ISO string\r\n  symbol: string;\r\n  side: Side;\r\n  type: OrderType;\r\n  qty: number;\r\n  price?: number;            // limit price (if LIMIT)\r\n  fillPrice: number;         // execution price\r\n};\r\n\r\n// helpers\r\nconst fmtMoney = (n: number) =>\r\n  `$${n.toLocaleString(undefined, { maximumFractionDigits: 2 })}`;\r\nconst fmtDate = (iso: string) =>\r\n  new Date(iso).toLocaleString([], { hour12: false });\r\n\r\nexport default function HistoryPage() {\r\n  const router = useRouter();\r\n  const { isLoggedIn } = useDemoSession();\r\n\r\n  // mount/auth gates (avoid early returns before hooks)\r\n  const [mounted, setMounted] = useState(false);\r\n  const [hasSession, setHasSession] = useState<boolean | null>(null);\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    try { setHasSession(!!localStorage.getItem('demo_session')); }\r\n    catch { setHasSession(false); }\r\n  }, []);\r\n  const authed = isLoggedIn || !!hasSession;\r\n\r\n  // orders + ui state\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [q, setQ] = useState('');               // search\r\n  const [side, setSide] = useState<'ALL' | Side>('ALL');\r\n  const [otype, setOtype] = useState<'ALL' | OrderType>('ALL');\r\n  const [sortBy, setSortBy] = useState<'time' | 'symbol' | 'amount'>('time');\r\n  const [dir, setDir] = useState<'desc' | 'asc'>('desc');\r\n\r\n  // load orders\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n    try {\r\n      const raw = JSON.parse(localStorage.getItem('demo_orders') || '[]') as Order[];\r\n      setOrders(raw);\r\n    } catch {\r\n      setOrders([]);\r\n    }\r\n  }, [mounted]);\r\n\r\n  // redirect once we know\r\n  useEffect(() => {\r\n    if (!mounted) return;\r\n    if (!authed) router.replace('/signin');\r\n  }, [mounted, authed, router]);\r\n\r\n  const filtered = useMemo(() => {\r\n    const s = q.trim().toUpperCase();\r\n    let rows = orders.filter(o =>\r\n      (!s || o.symbol.includes(s)) &&\r\n      (side === 'ALL' || o.side === side) &&\r\n      (otype === 'ALL' || o.type === otype)\r\n    );\r\n\r\n    rows = rows.sort((a, b) => {\r\n      let delta = 0;\r\n      if (sortBy === 'time') delta = new Date(a.time).getTime() - new Date(b.time).getTime();\r\n      if (sortBy === 'symbol') delta = a.symbol.localeCompare(b.symbol);\r\n      if (sortBy === 'amount') delta = a.fillPrice * a.qty - b.fillPrice * b.qty;\r\n      return dir === 'asc' ? delta : -delta;\r\n    });\r\n    return rows;\r\n  }, [orders, q, side, otype, sortBy, dir]);\r\n\r\n  function toggleSort(col: typeof sortBy) {\r\n    if (col === sortBy) setDir(d => (d === 'asc' ? 'desc' : 'asc'));\r\n    else { setSortBy(col); setDir('desc'); }\r\n  }\r\n\r\n  function clearHistory() {\r\n    localStorage.removeItem('demo_orders');\r\n    setOrders([]);\r\n  }\r\n\r\n  function exportCSV() {\r\n    const head = ['Time', 'Symbol', 'Side', 'Type', 'Qty', 'Limit Price', 'Fill Price', 'Notional'];\r\n    const rows = filtered.map(o => [\r\n      new Date(o.time).toISOString(),\r\n      o.symbol,\r\n      o.side,\r\n      o.type,\r\n      o.qty.toString(),\r\n      o.price ? o.price.toFixed(2) : '',\r\n      o.fillPrice.toFixed(2),\r\n      (o.fillPrice * o.qty).toFixed(2),\r\n    ]);\r\n    const csv = [head, ...rows].map(r => r.map(v => `\"${String(v).replace(/\"/g, '\"\"')}\"`).join(',')).join('\\n');\r\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = 'transactions.csv';\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  if (!mounted || !authed) return null;\r\n\r\n  return (\r\n    <main className=\"container\" style={{ paddingTop: 24, paddingBottom: 24 }}>\r\n      <div className=\"pageheader\">\r\n        <div>\r\n          <h1 className=\"stocks__title\">History</h1>\r\n          <p className=\"stocks__sub\">All filled orders in this demo session.</p>\r\n        </div>\r\n        <div className=\"header-actions\">\r\n          <button className=\"btn btn--ghost\" onClick={exportCSV}>Export CSV</button>\r\n          <button className=\"btn\" onClick={clearHistory} title=\"Remove all transactions\">\r\n            Clear history\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <section className=\"card table--bare\">\r\n        {/* Filters */}\r\n        <div className=\"actions-row\" style={{ marginBottom: 8 }}>\r\n          <input\r\n            className=\"field__input\"\r\n            placeholder=\"Search symbolâ€¦\"\r\n            value={q}\r\n            onChange={(e) => setQ(e.target.value)}\r\n            style={{ width: 220 }}\r\n          />\r\n          <div className=\"pillgroup\">\r\n            <button\r\n              className={`pillbtn ${side === 'ALL' ? 'is-active' : ''}`}\r\n              onClick={() => setSide('ALL')}\r\n              type=\"button\"\r\n            >All</button>\r\n            <button\r\n              className={`pillbtn ${side === 'BUY' ? 'is-active' : ''}`}\r\n              onClick={() => setSide('BUY')}\r\n              type=\"button\"\r\n            >Buy</button>\r\n            <button\r\n              className={`pillbtn ${side === 'SELL' ? 'is-active' : ''}`}\r\n              onClick={() => setSide('SELL')}\r\n              type=\"button\"\r\n            >Sell</button>\r\n          </div>\r\n          <div className=\"pillgroup\">\r\n            <button\r\n              className={`pillbtn ${otype === 'ALL' ? 'is-active' : ''}`}\r\n              onClick={() => setOtype('ALL')}\r\n              type=\"button\"\r\n            >Any type</button>\r\n            <button\r\n              className={`pillbtn ${otype === 'MARKET' ? 'is-active' : ''}`}\r\n              onClick={() => setOtype('MARKET')}\r\n              type=\"button\"\r\n            >Market</button>\r\n            <button\r\n              className={`pillbtn ${otype === 'LIMIT' ? 'is-active' : ''}`}\r\n              onClick={() => setOtype('LIMIT')}\r\n              type=\"button\"\r\n            >Limit</button>\r\n          </div>\r\n          <span className=\"badge\">Total: <strong>{filtered.length}</strong></span>\r\n        </div>\r\n\r\n        {/* Table header */}\r\n        <div className=\"table__head is-sticky\">\r\n          <button onClick={() => toggleSort('time')}>\r\n            Time <span className={`sort ${sortBy === 'time' ? (dir === 'asc' ? 'is-asc' : 'is-desc') : ''}`} />\r\n          </button>\r\n          <button onClick={() => toggleSort('symbol')}>\r\n            Symbol <span className={`sort ${sortBy === 'symbol' ? (dir === 'asc' ? 'is-asc' : 'is-desc') : ''}`} />\r\n          </button>\r\n          <button>Side</button>\r\n          <button>Type</button>\r\n          <button>Qty</button>\r\n          <button>Limit</button>\r\n          <button onClick={() => toggleSort('amount')}>\r\n            Fill <span className={`sort ${sortBy === 'amount' ? (dir === 'asc' ? 'is-asc' : 'is-desc') : ''}`} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Rows */}\r\n        {filtered.length === 0 ? (\r\n          <div className=\"muted\" style={{ padding: 16 }}>No transactions yet.</div>\r\n        ) : (\r\n          <ul className=\"table__body\">\r\n            {filtered.map(o => {\r\n              const notional = o.fillPrice * o.qty;\r\n              return (\r\n                <li key={o.id} className=\"row\"\r\n                    style={{ gridTemplateColumns: '1.6fr .8fr .7fr .9fr .6fr .9fr .9fr' }}>\r\n                  <div className=\"name\">\r\n                    <strong>{fmtDate(o.time)}</strong>\r\n                    <span className=\"symbol\">ID: {o.id.slice(0, 8)}</span>\r\n                  </div>\r\n                  <div className=\"num\">{o.symbol}</div>\r\n                  <div className={`num ${o.side === 'BUY' ? 'is-up' : 'is-down'}`}>{o.side}</div>\r\n                  <div className=\"num\">{o.type}</div>\r\n                  <div className=\"num\">{o.qty}</div>\r\n                  <div className=\"num\">{o.price ? fmtMoney(o.price) : '-'}</div>\r\n                  <div className=\"num\">{fmtMoney(o.fillPrice)} <span className=\"symbol\">({fmtMoney(notional)})</span></div>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}